package operacional;
import java_cup.runtime.*; 
import java.io.*;
import java.util.*;
import java.lang.*;

parser code{:
    /*-------------------------------Variables-----------------------------------*/
    int i=0;
    public an_lex lexer2 = new an_lex(new StringReader("\""));
    ArrayList errores = new ArrayList();
    ArrayList listap = new ArrayList();
    ArrayList NombreProyecto = new ArrayList();
    /*------------------------------Parser---------------------------------------*/
   
    public static void cargarFile(String archivo) throws Exception{
        new parser(new an_lex(new FileInputStream(archivo))).parse();
    }

    public Boolean cargarString(String texto) throws Exception{
        try{
            an_lex lexer = new an_lex(new StringReader(texto));
            parser parser_string = new parser(lexer);
            parser_string.parse();
            this.listap = parser_string.listap;
            this.errores = parser_string.errores;
            this.NombreProyecto = parser_string.NombreProyecto;
            lexer2=lexer;
            return true;
        }catch(Exception e){
            setError("Critico: Error en la lectura del texto.");
            return false;
        }      
    }
    public ArrayList getObjto(){
        return this.listap;
    }

    public void setResultado(ArrayList res){
        this.listap=res;
    }

    public void setError(Object o){
        errores.add(o);
    }
    public ArrayList getError(){
        return errores;
    }
    /*--------------------------------Lexer----------------------------------------*/
    public String[] getLexStatus(){
        return lexer2.getStatus();
    }

    public Integer[] getLexDetails() throws Exception{
        System.out.println("getdetalles:"+lexer2.getDetails());
        return lexer2.getDetails();
    } 
:}

action code{:

:}

terminal colon, llaveA, llaveC, coma, dcomilla,mas,menos,por,div; 

terminal String word;

terminal Double num;

non terminal Double Operaciones, Second, Valor, Valores;

non terminal ArrayList S, ListaP, ObAt;

non terminal NumLetra;

start with S;
S   ::= llaveA ObAt:atr coma ListaP:lista llaveC {: 
                                                        ArrayList fin = new ArrayList();
                                                        fin.add(atr);
                                                        fin.add(lista);
                                                        parser.NombreProyecto.add(atr);
                                                        RESULT=fin;
                                                        parser.setResultado(RESULT);
                                                        //System.out.println(RESULT+"\n");
                                                    :}
        | error:ee {: parser.setError("Critico: No se reconoce la gramatica en las variables proyecto, camara o plano, verificar el texto.");:};
ListaP  ::= ListaP:lp coma ObAt:ob2 {: 
                                            lp.add(ob2);
                                            RESULT=lp;
                                        :}
        | ObAt:ob1 {: 
                        ArrayList llp = new ArrayList();
                        llp.add(ob1);
                        RESULT =llp;
                    :};

ObAt  ::=  dcomilla NumLetra:nameO dcomilla colon llaveA ListaP:valO llaveC {: 
                                                                                ArrayList obj = new ArrayList();
                                                                                obj.add(nameO);
                                                                                obj.add(valO);
                                                                                RESULT = obj;
                                                                            :}
        |   dcomilla NumLetra:nameA dcomilla colon dcomilla NumLetra:valA dcomilla   {: 
                                                                                        ArrayList atri = new ArrayList();
                                                                                        atri.add(nameA);
                                                                                        atri.add(valA);  
                                                                                        RESULT =  atri;
                                                                                    :}
        | error:ee {: parser.setError("Critico: No se reconoce la gramatica en la lectura de objetos ");:};

NumLetra::= word:w {:   RESULT = w.toString();   :}

        | Operaciones:o {: RESULT = o;:}
        | error:ee {: parser.setError("Critico: No se reconoce la gramatica en leer valores o propiedades ");:};

Operaciones ::= Operaciones:o mas Second:s {: RESULT = o + s; :}
            | Operaciones:o menos Second:s {: RESULT = o - s; :}
            | Second:s {: RESULT = s; :};
Second  ::= Second:s por Valor:v {: RESULT = s * v; :}
        | Second:s  div Valor:v {: RESULT = s / v; :}
        | Valor:v {: RESULT = v; :};
Valor   ::= num:v {: RESULT = new Double(v);:};